const express=require('express');const http2=require('http2');const app=express();const port=process.env.PORT||3000;app.use(express.json());const sessions={};app.post('/',(req,res)=>{const{url}=req.body;res.status(200).send('ok');if(url){const u=new URL(url);const key=`${u.protocol}//${u.host}`;const fire=(session)=>{for(let i=0;i<76;i++){const stream=session.request({':method':'POST',':path':u.pathname,'content-type':'application/json'});stream.write(JSON.stringify({}));stream.end();stream.on('error',()=>{});}};if(!sessions[key]||sessions[key].destroyed||sessions[key].closed){const session=http2.connect(u.origin);session.on('error',()=>{delete sessions[key];});session.once('connect',()=>{sessions[key]=session;fire(session);});sessions[key]=session;}else{fire(sessions[key]);}}});app.get('/',(req,res)=>{res.status(200).send('ok');});app.listen(port,()=>{console.log(`Service running on port ${port}`);});
