const express=require('express');const http2=require('http2');const app=express();const port=process.env.PORT||3000;app.use(express.json());const sessions={};app.post('/',(req,res)=>{const{url}=req.body;res.status(200).send('ok');if(url){const u=new URL(url);const key=`${u.protocol}//${u.host}`;const sendRequests=()=>{for(let i=0;i<76;i++){const stream=sessions[key].request({':method':'POST',':path':u.pathname,'content-type':'application/json'});stream.write(JSON.stringify({}));stream.end();stream.on('error',()=>{});}};if(!sessions[key]||sessions[key].destroyed||sessions[key].closed){const newSession=http2.connect(u.origin);newSession.on('error',()=>{newSession.closed=true;delete sessions[key];});newSession.once('connect',sendRequests);sessions[key]=newSession;}else{sendRequests();}}});app.get('/',(req,res)=>{res.status(200).send('ok');});app.listen(port,()=>{console.log(`Service running on port ${port}`);});
