const express=require('express');const https=require('https');const app=express();const port=process.env.PORT||3000;app.use(express.json());app.get('/test',(req,res)=>{console.log('TEST ENDPOINT HIT');res.send('LOGS WORKING');});app.post('/',(req,res)=>{const{url}=req.body;console.log(`RECEIVED: ${url}`);res.status(200).send('OK');if(!url)return;const slashIndex=url.lastIndexOf('/');const lastPart=url.slice(slashIndex+1);const count=+lastPart||1;const targetUrl=url.slice(0,slashIndex+1);const countries=['BR','CA','CN','CZ','FR','DE','HK','IN','ID','IT','IL','JP','NL','PL','RU','SA','SG','KR','ES','GB','AE','US','VN'];console.log(`START: count=${count}`);let completed=0;let errors=0;for(let i=0;i<count;i++){setTimeout(()=>{const country=countries[i%24];const postData=`{"worker-id":${i}}`;const options={hostname:'api.scrapingant.com',port:443,path:`/v2/general?url=${encodeURIComponent(targetUrl)}&x-api-key=2a33de63f0054f1cb33f5857a3fe00c5&proxy_country=${country}&proxy_type=datacenter&browser=false`,method:'POST',headers:{'Content-Type':'application/json','Content-Length':Buffer.byteLength(postData)}};const req=https.request(options,(apiRes)=>{apiRes.on('data',()=>{});apiRes.on('end',()=>{completed++;if(completed===count)console.log(`DONE: ${completed} success, ${errors} errors`);});});req.on('error',()=>{errors++;completed++;if(completed===count)console.log(`DONE: ${completed} total, ${errors} errors`);});req.write(postData);req.end();},i*2000);}});app.listen(port,()=>console.log(`Port ${port}`));
